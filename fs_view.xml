<?xml version="1.0"?>
<openerp>
    <data>

        <menuitem name="FnxFS" id="fnx_file_system" groups="consumer"/>

        <record model="ir.ui.view" id="fnx_fs_folders_tree">
            <field name="name">Folders</field>
            <field name="model">fnx.fs.folder</field>
            <field name="arch" type="xml">
                <tree string="Folders" version="7.0">
                    <field name="path"/>
                    <field name="folder_type"/>
                    <field name="description"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="fnx_fs_folders_form">
            <field name="name">Folders</field>
            <field name="model">fnx.fs.folder</field>
            <field name="arch" type="xml">
                <form string="Folders" version="7.0">
                    <group>
                        <group>
                            <field name="id" invisible="1"/>
                            <field name="name"/>
                            <field name="path"/>
                            <field name="description"/>
                            <field name="parent_id" on_change="change_permissions(perm_type, parent_id, 'folder')"/>
                        </group>
                        <group>
                            <field name="folder_type"/>
                            <field name="mount_from" attrs="{'invisible':[('folder_type','!=','reflective')], 'required':[('folder_type','=','reflective')]}"/>
                            <field name="mount_options" attrs="{'invisible':[('folder_type','!=','reflective')]}"/>
                            <field name="owner_id" readwrite="groups('fnx_fs.manager')" attrs="{'invisible':[('folder_type','!=','shared')], 'required':[('folder_type','=','shared')]}"/>
                            <field name="file_folder_name" string="Shared Folder" attrs="{'invisible':[('folder_type','!=','shared')], 'required':[('folder_type','=','shared')]}"/>
                        </group>
                    </group>
                    <group attrs="{'invisible':[('id','=',False)]}">
                        <field name="child_ids" context="{'default_parent_id':active_id}"/>
                    </group>
                    <separator string="Default File Settings"/>
                    <group colspan="2">
                        <group>
                            <field name="perm_type" on_change="change_permissions(perm_type, parent_id, 'perm')" attrs="{'invisible':[('parent_id','=',False)]}"/>
                        </group>
                        <group>
                            <separatory colspan="2"/>
                        </group>
                        <group>
                            <field name="readonly_type"/>
                            <field name="readonly_ids" nolabel="1" attrs="{'invisible':[('readonly_type','=','all')]}" colspan="2">
                                <tree>
                                    <field name="name" string="Read Only Users"/>
                                </tree>
                            </field>
                        </group>
                        <group>
                            <separator attrs="{'invisible':[('readonly_type','=','all')]}" colspan="2"/>
                            <separator attrs="{'invisible':[('readonly_type','=','all')]}" colspan="2"/>
                            <field name="readwrite_ids" nolabel="1" colspan="2">
                                <tree>
                                    <field name="name" string="Read/Write Users"/>
                                </tree>
                            </field>
                        </group>
                    </group>
                    <notebook colspan="4">
                        <page string="Files" attrs="{'invisible':[('id','=',False)]}">
                            <field name="file_ids" nolabel="1" context="{'default_folder_id':active_id}">
                                <tree version="7.0" context="{'default_folder_id':folder_id}">
                                    <field name="shared_as" string="Share Name"/>
                                    <field name="user_id"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="fnx_fs_files_list">
            <field name="name">Files</field>
            <field name="model">fnx.fs.file</field>
            <field name="arch" type="xml">
                <tree string="Files" version="7.0">
                    <field name="folder_id"/>
                    <field name="file_name"/>
                    <field name="shared_as"/>
                    <field name="user_id"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="fnx_fs_files_form">
            <field name="name">Files</field>
            <field name="model">fnx.fs.file</field>
            <field name="arch" type="xml">
                <form string="File System" version="7.0">
                    <header>
                        <button string="(re)Publish File" name="fnx_fs_publish_file" type="object" attrs="{'invisible':[('file_type','=','normal')]}"/>
                    </header>
                    <sheet string="Files">
                        <group>
                            <group>
                                <field name="user_id" readwrite="groups('fnx_fs.manager')" widget="selection" options="{'create':False, 'create_edit':False, 'limit':15}"/>
                                <field name="file_type"/>
                                <field name="folder_id" on_change="change_permissions(perm_type, folder_id, 'folder')"/>
                                <field name="shared_as" attrs="{'required':[('file_type','=','normal')]}"/>
                            </group>
                            <group>
                                <field name="schedule_period" attrs="{'invisible':[('file_type','!=','auto')], 'required':[('file_type','=','auto')]}"/>
                                <field name="scheduled_at" attrs="{'invisible':[('file_type','!=','auto')], 'required':[('file_type','=','auto')]}"/>
                                <!-- <field name="schedule_date" attrs="{'invisible':[('file_type','!=','auto')], 'required':[('file_type','=','auto')]}"/>
                                <field name="schedule_time" attrs="{'invisible':[('file_type','!=','auto')], 'required':[('file_type','=','auto')]}" widget="float_time"/> -->
                            </group>
                            <group colspan="4">
                                <!-- <field name="file_name" attrs="{'invisible':[('file_type','=','normal')], 'required':[('file_type','!=','normal')]}"/> -->
                                <field name="file_name" attrs="{'required':[('file_type','!=','normal')]}"/>
                                <field name="ip_addr" readonly="True" class="oe_inline" attrs="{'invisible':[('file_type','=','normal')]}"/>
                                <field name="full_name" readonly="True" class="oe_inline" attrs="{'invisible':[('file_type','=','normal')]}"/>
                                <field name="perm_type" on_change="change_permissions(perm_type, folder_id, 'perm')"/>
                            </group>
                        </group>
                    <notebook colspan="4">
                        <page string="Shared To">
                            <group colspan="2">
                                <group>
                                    <field name="readonly_type" attrs="{'readonly':[('perm_type','=','inherit')]}"/>
                                    <field name="readonly_ids"  attrs="{'readonly':[('perm_type','=','inherit')], 'invisible':[('readonly_type','=','all')]}" nolabel="1" colspan="2">
                                        <tree>
                                            <field name="name" string="Read Only Users"/>
                                        </tree>
                                    </field>
                                </group>
                                <group>
                                    <separator attrs="{'invisible':[('readonly_type','=','all')]}" colspan="2"/>
                                    <separator attrs="{'invisible':[('readonly_type','=','all')]}" colspan="2"/>
                                    <field name="readwrite_ids" nolabel="1" colspan="2" attrs="{'readonly':[('perm_type','=','inherit')]}">
                                        <tree>
                                            <field name="name" string="Read/Write Users"/>
                                        </tree>
                                    </field>
                                </group>
                            </group>
                        </page>
                        <page string="Debugging (other fields)">
                            <group>
                                <field name="indexed_text"/>
                            </group>
                        </page>
                    </notebook>
                    <group string="Notes">
                        <field name="notes" nolabel="1"/>
                    </group>
                </sheet>
                </form>
            </field>
        </record>

        <record id="search_fnx_fs_filter" model="ir.ui.view">
            <field name="name">fnx.fs.file.select</field>
            <field name="model">fnx.fs.file</field>
            <field name="arch" type="xml">
                <search string="Search Files">
                    <!--
                    <field name="category" string="Function" filter_domain="[(1,'=',1)]"/>
                    <field name="status" string="Status" filter_domain="[(1,'=',1)]"/>
                    <field name="feedback" string="Communicated" filter_domain="[(1,'=',1)]"/>
                    -->
                    <filter string="My Files" domain="[]" context="[('user_id','=',uid)]"/>
                    <separator/>
                    <filter string="Shared By" domain="[]" context="[(1,'=',1)]"/>
                    <filter string="Location" domain="[]" context="[(1,'=',1)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Folder" domain="[]" context="{'group_by':'folder_id'}"/>
                        <filter string="Shared By" domain="[]" context="{'group_by':'user_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_fnx_fs_folders">
            <field name="name">Folders</field>
            <field name="res_model">fnx.fs.folder</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="fnx_fs_folders_tree"/>
            <field name="view_mode">tree,form</field>
            <field name="domain" eval=""/>
        </record>

        <record model="ir.actions.act_window" id="action_fnx_fs_files">
            <field name="name">Files</field>
            <field name="res_model">fnx.fs.file</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="fnx_fs_files_list"/>
            <field name="view_mode">list,form</field>
        </record>

        <menuitem
            name="File System" 
            id="fnx_fs_main" 
            parent="fnx_file_system" 
            sequence="10"
            />

        <menuitem
            name="Folders"
            id="fnx_fs_folders"
            parent="fnx_fs_main"
            action="action_fnx_fs_folders"
            sequence="10"
            />

        <menuitem
            name="Files"
            id="fnx_fs_files"
            parent="fnx_fs_main"
            action="action_fnx_fs_files"
            sequence="20"
            />
    </data>

</openerp>
