!!! xml1.0
~openerp
    ~data

        ~menuitem @FnxFS #fnx_file_system groups='consumer'

        ~record model='ir.ui.view' #fnx_fs_folders_tree
            @name: Folders
            @model: fnx.fs.folder
            @arch type='xml'
                ~tree $Folders version='7.0'
                    @path
                    @folder_type
                    @description

        ~record model='ir.ui.view' #fnx_fs_folders_form
            @name: Folders
            @model: fnx.fs.folder
            @arch type='xml'
                ~form $Folders version='7.0'
                    ~separator $Folder_Settings
                    ~group
                        ~group
                            @id invisible='1'
                            @name
                            @path
                            @description
                            @parent_id on_change="change_permissions(perm_type, parent_id, 'folder')" options="{'create':False, 'create_edit':False, 'limit':15}"
                        ~group
                            @folder_type
                            @mount_from attrs="{'invisible':[('folder_type','!=','reflective')], 'required':[('folder_type','=','reflective')]}"
                            @mount_options attrs="{'invisible':[('folder_type','!=','reflective')]}"
                            @share_owner_id attrs="{'invisible':[('folder_type','!=','shared')], 'required':[('folder_type','=','shared')]}" options="{'create':False, 'create_edit':False, 'limit':15}" writeonly="groups('fnx_fs.manager')"
                            @file_folder_name $Shared_Folder attrs="{'invisible':[('folder_type','!=','shared')], 'required':[('folder_type','=','shared')]}"
                    ~group attrs="{'invisible':[('id','=',False)]}"
                        @child_ids context="{'default_parent_id':active_id}"
                    ~group
                        @collaborative
                    ~separator $File_Settings
                    ~group colspan='2'
                        ~group
                            @perm_type attrs="{'invisible':[('parent_id','=',False)]}" on_change="change_permissions(perm_type, parent_id, 'perm')"
                        ~group
                            ~separatory colspan='2'
                        ~group
                            @readonly_type
                            @readonly_ids attrs="{'invisible':[('readonly_type','=','all')]}" colspan='2' nolabel='1'
                                ~tree
                                    @name $Read_Only_Users
                        ~group
                            ~separator attrs="{'invisible':[('readonly_type','=','all')]}" colspan='2'
                            ~separator attrs="{'invisible':[('readonly_type','=','all')]}" colspan='2'
                            @readwrite_ids colspan='2' nolabel='1'
                                ~tree
                                    @name string='Read/Edit Users'
                    ~notebook colspan='4'
                        ~page $Files attrs="{'invisible':[('id','=',False)]}"
                            @file_ids context="{'default_folder_id':active_id}" nolabel='1'
                                ~tree context="{'default_folder_id':folder_id}" version='7.0'
                                    @shared_as $Share_Name
                                    @user_id

        ~record model='ir.ui.view' #fnx_fs_files_list
            @name: Files
            @model: fnx.fs.file
            @arch type='xml'
                ~tree $Files version='7.0'
                    @folder_id
                    @file_name
                    @shared_as
                    @user_id

        ~record model='ir.ui.view' #fnx_fs_files_form
            @name: Files
            @model: fnx.fs.file
            @arch type='xml'
                ~form $File_System version='7.0'
                    ~header
                        ~button @fnx_fs_publish_file string='(re)Publish File' attrs="{'invisible':[('file_type','=','normal')]}" type='object'
                    ~sheet $Files
                        ~group
                            ~group
                                @user_id options="{'create':False, 'create_edit':False, 'limit':15}" required='1' writeonly="groups('fnx_fs.manager')"
                                @file_type on_change='change_file_type(file_type)'
                                @folder_id on_change="change_permissions(perm_type, folder_id, 'folder')"
                                @shared_as attrs="{'required':[('file_type','=','normal')]}"
                            ~group
                                @schedule_period attrs="{'invisible':[('file_type','!=','auto')], 'required':[('file_type','=','auto')]}"
                                @scheduled_at attrs="{'invisible':[('file_type','!=','auto')], 'required':[('file_type','=','auto')]}"
                            ~group colspan='4'
                                @file_name attrs="{'required':[('file_type','!=','normal')]}"
                                @ip_addr .oe_inline attrs="{'invisible':[('file_type','=','normal')]}" readonly='True'
                                @full_name .oe_inline attrs="{'invisible':[('file_type','=','normal')]}" readonly='True'
                                @perm_type on_change="change_permissions(perm_type, folder_id, 'perm')"
                        ~notebook colspan='4'
                            ~page $Shared_To
                                ~group colspan='2'
                                    ~group
                                        @readonly_type attrs="{'readonly':[('perm_type','=','inherit')]}"
                                        @readonly_ids attrs="{'readonly':[('perm_type','=','inherit')], 'invisible':[('readonly_type','=','all')]}" colspan='2' nolabel='1' options="{'create':False, 'create_edit':False, 'limit':15}"
                                            ~tree
                                                @name $Read_Only_Users
                                    ~group
                                        ~separator attrs="{'invisible':[('readonly_type','=','all')]}" colspan='2'
                                        ~separator attrs="{'invisible':[('readonly_type','=','all')]}" colspan='2'
                                        @readwrite_ids attrs="{'readonly':[('perm_type','=','inherit')]}" colspan='2' nolabel='1' options="{'create':False, 'create_edit':False, 'limit':15}"
                                            ~tree
                                                @name string='Read/Edit Users'
                            ~page string='Debugging (other fields)'
                                ~group
                                    @indexed_text
                        ~group $Notes
                            @notes nolabel='1'

        ~record model='ir.ui.view' #search_fnx_fs_filter
            @name: fnx.fs.file.select
            @model: fnx.fs.file
            @arch type='xml'
                ~search $Search_Files
                    ~group $Group_By... expand='0'
                        ~filter $Folder context="{'group_by':'folder_id'}" domain='[]'
                        ~filter $Shared_By context="{'group_by':'user_id'}" domain='[]'

        ~record model='ir.actions.act_window' #action_fnx_fs_folders
            @name: Folders
            @res_model: fnx.fs.folder
            @view_type: form
            @view_id ref='fnx_fs_folders_tree'
            @view_mode: tree,form
            @domain eval=''

        ~record model='ir.actions.act_window' #action_fnx_fs_files
            @name: Files
            @res_model: fnx.fs.file
            @view_type: form
            @view_id ref='fnx_fs_files_list'
            @view_mode: list,form

        ~menuitem name='File System' #fnx_fs_main parent='fnx_file_system' sequence='10'
        ~menuitem @Folders #fnx_fs_folders action='action_fnx_fs_folders' parent='fnx_fs_main' sequence='10'
        ~menuitem @Files #fnx_fs_files action='action_fnx_fs_files' parent='fnx_fs_main' sequence='20'
