<?xml version="1.0"?>
<openerp>
    <data>

        <menuitem name="FnxFS" id="fnx_file_system" groups="group_fnx_fs_consumer"/>

        <record model="ir.ui.view" id="fnx_fs_folders_tree">
            <field name="name">Folders</field>
            <field name="model">fnx.fs.folders</field>
            <field name="arch" type="xml">
                <tree string="Folders" version="7.0">
                    <field name="name"/>
                    <field name="description"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="fnx_fs_folders_form">
            <field name="name">Folders</field>
            <field name="model">fnx.fs.folders</field>
            <field name="arch" type="xml">
                <form string="Folders" version="7.0">
                    <group>
                        <field name="name"/>
                        <field name="description"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Files">
                            <field name="file_ids" nolabel="1" options="{'create':False, 'create_edit':False}">
                                <tree version="7.0">
                                    <field name="file_name"/>
                                    <field name="user_id"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="fnx_fs_files_list">
            <field name="name">Files</field>
            <field name="model">fnx.fs.files</field>
            <field name="arch" type="xml">
                <tree string="Files" version="7.0">
                    <field name="folder_id"/>
                    <field name="file_name"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="fnx_fs_files_form">
            <field name="name">Files</field>
            <field name="model">fnx.fs.files</field>
            <field name="arch" type="xml">
                <form string="File System" version="7.0">
                    <header>
                        <button string="Refresh/Update" name="_scan_fs" type="object"/>
                    </header>
                    <sheet string="Files">
                        <group>
                            <group>
                                <field name="user_id" attrs="{'readonly':True}" widget="selection" options="{'create':False, 'create_edit':False, 'limit':15}"/>
                                <field name="source_file"/>
                                <field name="folder_id" widget="selection"/>
                            </group>
                        </group>
                    <notebook colspan="4">
                        <page string="Shared To">
                            <group colspan="2">
                                <group>
                                    <field name="readonly_ids" nolabel="1">
                                        <tree>
                                            <field name="name" string="Read Only Users"/>
                                        </tree>
                                    </field>
                                </group>
                                <group>
                                    <field name="readwrite_ids" nolabel="1">
                                        <tree>
                                            <field name="name" string="Read/Write Users"/>
                                        </tree>
                                    </field>
                                </group>
                            </group>
                        </page>
                        <page string="Debugging (other fields)">
                            <field name="edit_url" widget="url"/>
                            <field name="share_url" widget="url"/>
                            <field name="ip_addr"/>
                            <field name="file_path"/>
                            <field name="file_name"/>
                            <field name="indexed_text"/>
                        </page>
                    </notebook>
                    <group string="Notes">
                        <field name="notes" nolabel="1"/>
                    </group>
                </sheet>
                </form>
            </field>
        </record>

        <record id="search_fnx_fs_filter" model="ir.ui.view">
            <field name="name">fnx.fs.files.select</field>
            <field name="model">fnx.fs.files</field>
            <field name="arch" type="xml">
                <search string="Search Files">
                    <!--
                    <field name="category" string="Function" filter_domain="[(1,'=',1)]"/>
                    <field name="status" string="Status" filter_domain="[(1,'=',1)]"/>
                    <field name="feedback" string="Communicated" filter_domain="[(1,'=',1)]"/>
                    -->
                    <filter string="My Files" domain="[]" context="[('user_id','=',uid)]"/>
                    <separator/>
                    <filter string="Shared By" domain="[]" context="[(1,'=',1)]"/>
                    <filter string="Location" domain="[]" context="[(1,'=',1)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Shared By" domain="[]" context="{'group_by':'user_id'}"/>
                        <filter string="Location" domain="[]" context="{'group_by':'file_path'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_fnx_fs_folders">
            <field name="name">Folders</field>
            <field name="res_model">fnx.fs.folders</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="fnx_fs_folders_tree"/>
            <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.act_window" id="action_fnx_fs_files">
            <field name="name">Files</field>
            <field name="res_model">fnx.fs.files</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="fnx_fs_files_list"/>
            <field name="view_mode">list,form</field>
        </record>

        <record model="ir.actions.act_window" id="action_fnx_fs_my_files">
            <field name="name">Files</field>
            <field name="res_model">fnx.fs.files</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="fnx_fs_files_list"/>
            <field name="view_mode">list,form</field>
        </record>

        <menuitem
            name="File System" 
            id="fnx_fs_main" 
            parent="fnx_file_system" 
            sequence="10"
            />

        <menuitem
            name="Folders"
            id="fnx_fs_folders"
            parent="fnx_fs_main"
            action="action_fnx_fs_folders"
            sequence="10"
            />

        <menuitem
            name="Files"
            id="fnx_fs_files"
            parent="fnx_fs_main"
            action="action_fnx_fs_files"
            groups="group_fnx_fs_consumer"
            sequence="20"
            />

        <menuitem
            name="My Shared Files"
            id="fnx_fs_my_files"
            parent="fnx_fs_main"
            action="action_fnx_fs_my_files"
            groups="group_fnx_fs_creator"
            sequence="30"
            />

    </data>

    <data noupdate="1">
        <record model="ir.cron" id="fnx_fs_files_update">
            <field name="name">Fnx FS Files Update</field>
            <field name="interval_number">30</field>
            <field name="interval_type">minutes</field>
            <field name="numbercall">-1</field>
            <field name="doall" eval="False"/>
            <field name="model" eval="'fnx.fs.files'"/>
            <field name="function" eval="'_scan_fs'"/>
            <field name="args" eval="'()'"/>
            <field name="nextcall" eval="'2013-07-31 00:00:00'"/>
            <field name="priority">100</field>
        </record>
    </data>

</openerp>
